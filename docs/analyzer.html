<!DOCTYPE html>

<html>
<head>
  <title>analyzer.rb</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="analyzer.html">
                analyzer.rb
              </a>
            
              
              <a class="source" href="cli.html">
                cli.rb
              </a>
            
              
              <a class="source" href="data_struct.html">
                data_struct.rb
              </a>
            
              
              <a class="source" href="database_connection.html">
                database_connection.rb
              </a>
            
              
              <a class="source" href="exporter.html">
                exporter.rb
              </a>
            
              
              <a class="source" href="immunoscore_results_loader.html">
                immunoscore_results_loader.rb
              </a>
            
              
              <a class="source" href="mongo_aggregator.html">
                mongo_aggregator.rb
              </a>
            
              
              <a class="source" href="semicolon_cleaner.html">
                semicolon_cleaner.rb
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>analyzer.rb</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">require</span> <span class="hljs-string">'bundler/setup'</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">"mongo_mapper"</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">"csv"</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">"gibberish"</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'bicrypt'</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">"chronic"</span>



require_relative <span class="hljs-string">"database_connection"</span>



<span class="hljs-constant">MongoMapper</span>.database = <span class="hljs-constant">DATABASE_NAME</span>


<span class="hljs-function"><span class="hljs-keyword">def</span> </span>prompt(*args)
    print(*args)
    gets.strip
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="encryption-and-decryption">Encryption and decryption</h2>
<p>monkeypatching String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="cypher-p-p">cypher p p</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.set_encryption
    cypher=prompt <span class="hljs-string">"enter encryption cypher: "</span>
    <span class="hljs-variable">$e</span> = <span class="hljs-constant">BiCrypt</span>.new(cypher)
  <span class="hljs-keyword">end</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>decrypt
    <span class="hljs-keyword">if</span> <span class="hljs-variable">$e</span>==<span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-constant">String</span>.set_encryption <span class="hljs-keyword">end</span>
    <span class="hljs-variable">$e</span>.decrypt_string <span class="hljs-constant">Base64</span>.decode64 <span class="hljs-keyword">self</span>.encode(<span class="hljs-string">'ascii-8bit'</span>)
  <span class="hljs-keyword">end</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>encrypt
  <span class="hljs-keyword">if</span> <span class="hljs-variable">$e</span>==<span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-constant">String</span>.set_encryption <span class="hljs-keyword">end</span>
  <span class="hljs-constant">Base64</span>.encode64(<span class="hljs-variable">$e</span>.encrypt_string(<span class="hljs-keyword">self</span>)).encode(<span class="hljs-string">'utf-8'</span>)
  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>some normalization of SS entries necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>md5
  <span class="hljs-constant">Gibberish::MD5</span> (<span class="hljs-keyword">self</span>.gsub <span class="hljs-string">"-"</span>,<span class="hljs-string">""</span>).strip()
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="creates-a-mongomapper-class">creates a mongomapper class</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>make_mongo_class class_name
  <span class="hljs-keyword">self</span>.instance_variable_set <span class="hljs-string">"@<span class="hljs-subst">#{class_name}</span>"</span>, <span class="hljs-constant">Class</span>.new
  c=<span class="hljs-keyword">self</span>.instance_variable_get <span class="hljs-string">"@<span class="hljs-subst">#{class_name}</span>"</span>
  c.class_eval <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">include</span> <span class="hljs-constant">MongoMapper::Document</span>
  <span class="hljs-keyword">end</span>
  c
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="utility-for-extrapolating-mongotype">Utility for extrapolating MongoType</h2>
<p>need dates…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>correct
    <span class="hljs-keyword">case</span> <span class="hljs-keyword">self</span>
    <span class="hljs-keyword">when</span> <span class="hljs-string">"String"</span>
      <span class="hljs-string">"String"</span>
    <span class="hljs-keyword">when</span> <span class="hljs-string">"Fixnum"</span>
      <span class="hljs-string">"Integer"</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h1 id="array-of-rows-to-excel-file">Array of rows to excel file</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Array</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>to_table
    t=<span class="hljs-constant">Tempfile</span>.new(<span class="hljs-string">"foo"</span>)
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |row|
      t.write row.to_csv
    <span class="hljs-keyword">end</span>
    t.close
    puts t.path
    new_table=<span class="hljs-constant">CSV</span>.table t.path
    `rm <span class="hljs-comment">#{t.path}`</span>
    new_table
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="splits-name-in-array-components">Splits name in array components</h2>
<p>always returns array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>name_split text_string
  <span class="hljs-keyword">if</span> text_string.index <span class="hljs-string">" "</span> <span class="hljs-keyword">or</span>  text_string.index <span class="hljs-string">","</span>
    <span class="hljs-keyword">return</span> (text_string.split(<span class="hljs-string">" "</span>).split(<span class="hljs-string">","</span>) ).flatten
  <span class="hljs-keyword">else</span> 
    <span class="hljs-keyword">return</span> [text_string].flatten
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="removes-names-from-surg-path-text">Removes names from surg path text</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>names_cleaner text, names

  names.map!{|z| split_if_space z}.flatten! <span class="hljs-keyword">if</span> names.<span class="hljs-keyword">class</span>==<span class="hljs-constant">Array</span>
  names=name_split names <span class="hljs-keyword">if</span> names.<span class="hljs-keyword">class</span>==<span class="hljs-constant">String</span>
  names.each <span class="hljs-keyword">do</span> |n|

    r=<span class="hljs-constant">Regexp</span>.new(n, <span class="hljs-constant">Regexp::IGNORECASE</span>)  
    text.gsub! r,<span class="hljs-string">""</span>
    puts <span class="hljs-string">"cleaned <span class="hljs-subst">#{n}</span>"</span>
  <span class="hljs-keyword">end</span>
  text
<span class="hljs-keyword">end</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CSV::Row</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>pp
    <span class="hljs-keyword">self</span>.to_hash 
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="a-modified-csv-table-class">A modified CSV table class</h2>
<p>Can Decrypt and encrypt</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CSV::Table</span></span>
  <span class="hljs-keyword">attr_accessor</span> <span class="hljs-symbol">:file_path</span>, <span class="hljs-symbol">:data_classifier</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>encrypt col_name
    <span class="hljs-keyword">if</span> <span class="hljs-variable">$e</span>==<span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-constant">String</span>.set_encryption <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |row|
      row[col_name]=row[col_name].to_s.encrypt
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>encrypt_col_names col_names_array
    col_names_array.each <span class="hljs-keyword">do</span> |col_name|
      <span class="hljs-keyword">self</span>.encrypt col_name
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>decrypt col_name
    <span class="hljs-keyword">if</span> <span class="hljs-variable">$e</span>==<span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-constant">String</span>.set_encryption <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |row|
      row[col_name]=row[col_name].to_s.decrypt
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>clean_names names_col, diagnosis_col
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |row|
      row[diagnosis_col]=names_cleaner row[diagnosis_col],row[names_col]
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>md5 col_name
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |row|
      row[col_name]=row[col_name].to_s.md5
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>save file_name
    <span class="hljs-constant">CSV</span>.open(file_name, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">do</span> |csv|
      csv &lt;&lt; <span class="hljs-keyword">self</span>.headers
      <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |line|
        csv &lt;&lt; line.fields
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>z.find_rows :diagnosis_text,  /.(T\d)./i</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>find_rows col_name, regex, decrypt=<span class="hljs-keyword">false</span>
    new_table=[]&lt;&lt;<span class="hljs-keyword">self</span>.headers
    <span class="hljs-keyword">if</span> decrypt <span class="hljs-keyword">then</span> <span class="hljs-keyword">self</span>.decrypt col_name <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">self</span>[col_name].each_with_index <span class="hljs-keyword">do</span> |r,i|</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>puts r</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> r.match regex
        puts i
        new_table&lt;&lt;<span class="hljs-keyword">self</span>[i]
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    new_table.to_table
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>to_mongo mongo_class
    <span class="hljs-keyword">self</span>.each_with_index <span class="hljs-keyword">do</span> |row,i|
      m=mongo_class.new
      <span class="hljs-keyword">self</span>.headers.each <span class="hljs-keyword">do</span> |header|
        puts <span class="hljs-string">"working on <span class="hljs-subst">#{header}</span> in row <span class="hljs-subst">#{i}</span>"</span>
        m[header]=row[header]
      <span class="hljs-keyword">end</span>
      m.save
      puts <span class="hljs-string">"<span class="hljs-subst">#{i}</span>: <span class="hljs-subst">#{mongo_class.count}</span>"</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>mongo_code
    <span class="hljs-keyword">self</span>.data_classifier.print_class
  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">alias</span> <span class="hljs-symbol">:print_mongo</span> <span class="hljs-symbol">:mongo_code</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="check-if-a-file-is-an-idiotic-csv">Check if a file is an idiotic ; csv</h2>
<p>by counting ; and , in header line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>is_semicolon? file_path
  csv=<span class="hljs-constant">CSV</span>.read(file_path)
  <span class="hljs-keyword">if</span> (csv <span class="hljs-keyword">and</span> csv.count !=<span class="hljs-number">0</span>)
    puts file_path
    header=csv[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    <span class="hljs-keyword">if</span> header==<span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span> <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> (header <span class="hljs-keyword">and</span> header.count(<span class="hljs-string">";"</span>))&gt;header.count(<span class="hljs-string">","</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="check-if-a-tab-file">Check if a tab file</h2>
<p>by counting \t and , in header line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>is_tab? file_path
  csv=<span class="hljs-constant">CSV</span>.read(file_path)
  <span class="hljs-keyword">if</span> (csv <span class="hljs-keyword">and</span> csv.count !=<span class="hljs-number">0</span>)
    puts file_path
    header=csv[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    <span class="hljs-keyword">if</span> header==<span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span> <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> (header <span class="hljs-keyword">and</span> header.count(<span class="hljs-string">"\t"</span>))&gt;header.count(<span class="hljs-string">","</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2 id="remove-semicolons">Remove semicolons</h2>
<p>; =&gt; ,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>remove_semicolon file_path
  puts <span class="hljs-string">"removing semicolons in <span class="hljs-subst">#{file_path}</span>"</span>
  c=<span class="hljs-constant">CSV</span>.table file_path, <span class="hljs-symbol">:col_sep=&gt;</span> <span class="hljs-string">";"</span>
  fh=<span class="hljs-constant">File</span>.new file_path, <span class="hljs-string">"w"</span>
  fh.write c.to_csv
  fh.close
  <span class="hljs-keyword">return</span> file_path
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="remove-tabs">Remove tabs</h2>
<p>; =&gt; ,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>remove_tabs file_path
  puts <span class="hljs-string">"removing tabs in <span class="hljs-subst">#{file_path}</span>"</span>
  c=<span class="hljs-constant">CSV</span>.table file_path, <span class="hljs-symbol">:col_sep=&gt;</span> <span class="hljs-string">"\t"</span>
  fh=<span class="hljs-constant">File</span>.new file_path, <span class="hljs-string">"w"</span>
  fh.write c.to_csv
  fh.close
  ext=<span class="hljs-constant">File</span>.extname file_path
  <span class="hljs-keyword">if</span> ext==<span class="hljs-string">".xls"</span> 
    `cp <span class="hljs-comment">#{file_path} #{file_path.gsub ext,".csv"}` </span>
    <span class="hljs-keyword">return</span> file_path.gsub ext,<span class="hljs-string">".csv"</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> file_path
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h2 id="a-modified-csv-table-class">A modified CSV table class</h2>
<p>Can Decrypt and encrypt</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CSV::Table</span></span>
  <span class="hljs-keyword">attr_accessor</span> <span class="hljs-symbol">:file_path</span>, <span class="hljs-symbol">:data_classifier</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>remove duplicates</p>
<p>takes col to search through </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>remove_duplicate  col
    col_all=<span class="hljs-keyword">self</span>[col]
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |row|
      entry=row[col]
      <span class="hljs-keyword">if</span> col_all.count(entry) &gt;= <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>deletes entries from index and from table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">self</span>.delete col_all.rindex(entry)
        col_all.delete_at col_all.rindex(entry)
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>



<span class="hljs-function"><span class="hljs-keyword">def</span> </span>make_class_name file_path
  <span class="hljs-constant">File</span>.basename((file_path).gsub(<span class="hljs-string">"."</span>,<span class="hljs-string">"_"</span>).gsub(<span class="hljs-string">"@"</span>,<span class="hljs-string">""</span>).gsub(<span class="hljs-string">"%"</span>,<span class="hljs-string">""</span>).gsub(<span class="hljs-string">"-"</span>,<span class="hljs-string">""</span>)).camelize

<span class="hljs-keyword">end</span>


<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">StringToMongo</span></span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.<span class="hljs-keyword">nil</span>? text_string
    <span class="hljs-keyword">if</span> text_string==<span class="hljs-keyword">nil</span>
      <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.integer? text_string
    <span class="hljs-keyword">if</span> text_string.match /^\d*<span class="hljs-variable">$/</span>
      <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.float? text_string
    <span class="hljs-keyword">if</span> text_string.match /^\d*\.\d*<span class="hljs-variable">$/</span>
      <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.date? text_string
    <span class="hljs-keyword">if</span> <span class="hljs-constant">Chronic</span>.parse(text_string) != <span class="hljs-keyword">nil</span>
      <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.mongo_type text_string
    <span class="hljs-keyword">case</span> 
    <span class="hljs-keyword">when</span> <span class="hljs-keyword">nil</span>?(text_string)
      <span class="hljs-string">"String"</span>
    <span class="hljs-keyword">when</span> integer?(text_string)
      <span class="hljs-string">"Integer"</span>
    <span class="hljs-keyword">when</span> float?(text_string)
      <span class="hljs-string">"Float"</span>
    <span class="hljs-keyword">when</span> date?(text_string)
      <span class="hljs-string">"Time"</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-string">"String"</span>
      
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ColName</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.fix_spaces col_name
    col_name.gsub(<span class="hljs-string">"."</span>,<span class="hljs-string">"_"</span>).gsub(<span class="hljs-string">" "</span>,<span class="hljs-string">"_"</span>)
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span><span class="hljs-keyword">self</span>.fix_numbers col_name
    matches=(col_name.scan /(\d)/)
    <span class="hljs-keyword">if</span> matches==[]
      puts <span class="hljs-string">"no match"</span>
      <span class="hljs-keyword">return</span> col_name
    <span class="hljs-keyword">else</span> 
      n=matches[<span class="hljs-number">0</span>]
      puts <span class="hljs-string">"captures <span class="hljs-subst">#{n}</span> <span class="hljs-subst">#{n.<span class="hljs-keyword">class</span>}</span>"</span>
      <span class="hljs-keyword">case</span> n
      <span class="hljs-keyword">when</span> <span class="hljs-string">"1"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"one"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"2"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"two"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"3"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"three"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"4"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"four"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"5"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"five"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"6"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"six"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"7"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"seven"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"8"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"eight"</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-string">"9"</span>
        puts n
        col_name.gsub!(n,<span class="hljs-string">"nine"</span>)
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    col_name
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h2 id="creates-a-mongo-class-mapping-csv-file">Creates a Mongo Class mapping csv file</h2>
<p>d=DataClassifier.new “/Users/carlobifulco/Dropbox/code/next_gen/hotspot2.csv”
d.print_class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataClassifier</span></span>
  <span class="hljs-keyword">attr_accessor</span> <span class="hljs-symbol">:headers</span>, <span class="hljs-symbol">:fs_line</span>,<span class="hljs-symbol">:keys_types</span>,<span class="hljs-symbol">:file_name</span>,<span class="hljs-symbol">:template</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>initialize file_name=<span class="hljs-string">"test.csv"</span>
  
    <span class="hljs-variable">@header_zip</span>=<span class="hljs-keyword">self</span>.cheap_headers file_name
 
    <span class="hljs-variable">@file_name</span>=file_name
    <span class="hljs-variable">@class_name</span>=make_class_name file_name</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>self.instance_variable_set “@#{@class_name}”,make_mongo_class(@class_name)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
    <span class="hljs-variable">@template</span>=<span class="hljs-string">""</span><span class="hljs-string">"
class <span class="hljs-subst">#{<span class="hljs-variable">@class_name</span>}</span>
  include MongoMapper::Document
  include DataUtilities
  safe
  timestamps!
    "</span><span class="hljs-string">""</span>
  <span class="hljs-keyword">end</span>



  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>cheap_headers file_path
    index=<span class="hljs-number">0</span>
    container=[]
    <span class="hljs-constant">CSV</span>.foreach(file_path) <span class="hljs-keyword">do</span> |row|
      container&lt;&lt;row</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>puts row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      index+=<span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> index&gt;<span class="hljs-number">2</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">break</span> <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    container[<span class="hljs-number">0</span>]=container[<span class="hljs-number">0</span>].map{|x| x.gsub(<span class="hljs-string">"."</span>,<span class="hljs-string">"_"</span>).downcase}
    zipped=container[<span class="hljs-number">0</span>].zip container[<span class="hljs-number">1</span>]
    zipped.select {|x| x[<span class="hljs-number">0</span>]!=<span class="hljs-string">""</span> <span class="hljs-keyword">and</span> x[<span class="hljs-number">0</span>]!=<span class="hljs-keyword">nil</span>}
  <span class="hljs-keyword">end</span>


  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>mongo_types
    <span class="hljs-variable">@header_zip</span>.each_with_object({})  <span class="hljs-keyword">do</span> |hz,container|
      key=hz[<span class="hljs-number">0</span>].gsub(<span class="hljs-string">" "</span>,<span class="hljs-string">"_"</span>)
      container[hz[<span class="hljs-number">0</span>].to_sym]=<span class="hljs-constant">StringToMongo</span>.mongo_type hz[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>prints the class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>print_class
    puts template
    <span class="hljs-keyword">self</span>.mongo_types.sort_by{|k,v| k}.each <span class="hljs-keyword">do</span> |r|
      puts <span class="hljs-string">"  key :<span class="hljs-subst">#{r[<span class="hljs-number">0</span>]}</span>, <span class="hljs-subst">#{r[<span class="hljs-number">1</span>]}</span> "</span>
    <span class="hljs-keyword">end</span>
    puts <span class="hljs-string">"end"</span>
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h2 id="remove-empty-columns-from-csv-files">remove empty columns from CSV files</h2>
<p>also deals with some windows encoding issues if needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>remove_nil_headers file_path
  <span class="hljs-keyword">begin</span>
    c=<span class="hljs-constant">CSV</span>.read(file_path,<span class="hljs-symbol">:headers</span> =&gt; <span class="hljs-keyword">true</span>)
  <span class="hljs-keyword">rescue</span>
    c=<span class="hljs-constant">CSV</span>.read(<span class="hljs-variable">@file_name</span>,<span class="hljs-symbol">:headers</span> =&gt; <span class="hljs-keyword">true</span>,  <span class="hljs-symbol">:encoding</span> =&gt; <span class="hljs-string">'windows-1251:utf-8'</span>)
  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span> c.headers.<span class="hljs-keyword">include</span>? <span class="hljs-keyword">nil</span>
    c.by_col!
    <span class="hljs-keyword">while</span> c.headers.index(<span class="hljs-keyword">nil</span>) != <span class="hljs-keyword">nil</span>
      c.delete(c.headers.index(<span class="hljs-keyword">nil</span>))
    <span class="hljs-keyword">end</span>
    fh=<span class="hljs-constant">File</span>.new file_path, <span class="hljs-string">"w"</span>
    fh.write c.to_csv
    fh.close
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2 id="factory-for-new-tables">Factory for new tables</h2>
<p>takes care of definiens and also stores file paths
also removes nil headers\
also deals with tab formatted files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>load_table file_path
  <span class="hljs-keyword">if</span> is_semicolon?(file_path) 
    file_path=remove_semicolon(file_path) 
  <span class="hljs-keyword">elsif</span> is_tab?(file_path) 
    file_path=remove_tabs(file_path) 
  <span class="hljs-keyword">end</span>
  remove_nil_headers file_path
  c=<span class="hljs-constant">CSV</span>.table file_path
  c.file_path=file_path
  <span class="hljs-keyword">begin</span>
    c.data_classifier=<span class="hljs-constant">DataClassifier</span>.new file_path
  <span class="hljs-keyword">rescue</span>
    c.data_classifier=<span class="hljs-keyword">false</span>
  <span class="hljs-keyword">end</span>
  c
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2 id="mongoloader">MongoLoader</h2>
<p>takes a class and a file csv file and then load it into Mongo
def mongo_loader mongo_class, file_path
  counter=0
  CSV.foreach(file_path) do |row|</p>
<pre><code><span class="hljs-comment">#puts row</span>
puts counter
<span class="hljs-keyword">if</span> counter==<span class="hljs-number">0</span> 
  <span class="hljs-variable">@headers</span>=row
  counter+=<span class="hljs-number">1</span>
  <span class="hljs-keyword">next</span>
<span class="hljs-keyword">end</span>
puts counter
m=mongo_class.new 
row.each_with_index <span class="hljs-keyword">do</span> |e,i|
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <pre><code>  <span class="hljs-comment">#puts "HEADERS: #{<span class="hljs-yardoctag">@headers</span>}"</span>
  <span class="hljs-comment">#puts <span class="hljs-yardoctag">@headers</span>[i]</span>
  m[<span class="hljs-variable">@headers</span>[i].gsub(<span class="hljs-string">"."</span>,<span class="hljs-string">"_"</span>).downcase]=e
  m.save
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">end</span>
puts counter
counter+=<span class="hljs-number">1</span>
</code></pre><p>  end
  “”
end</p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h2 id="load-csv-file-into-mongo-class">Load CSV file into mongo class</h2>
<p>Mongo class needs to exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>csv_to_mongo file_name=<span class="hljs-string">"test.csv"</span>,mongo_class=<span class="hljs-constant">TestCsv</span>
  t=<span class="hljs-constant">CSV</span>.table file_name
  t.each_with_index <span class="hljs-keyword">do</span> |row,i|
    m=mongo_class.new
    t.headers.each <span class="hljs-keyword">do</span> |header|
      m[header]=row[header]
    <span class="hljs-keyword">end</span>
    m.save
    puts <span class="hljs-string">"<span class="hljs-subst">#{i}</span>: <span class="hljs-subst">#{mongo_class.count}</span>"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2 id="convinience-for-mongomapper-classes">Convinience for Mongomapper classes</h2>
<p>export to csv</p>
<p>pretty printing of keys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">DataUtilities</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="export-csv">Export csv</h2>
<p>file_path - the file to be exported to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>export file_path
    <span class="hljs-constant">CSV</span>.open(file_path, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">do</span> |csv|
      headers=<span class="hljs-keyword">self</span>.<span class="hljs-keyword">class</span>.keys.keys.sort
      puts headers
      csv &lt;&lt; headers
      <span class="hljs-keyword">self</span>.<span class="hljs-keyword">class</span>.all.each <span class="hljs-keyword">do</span> |c|
        line=[]
        headers.each <span class="hljs-keyword">do</span> |h|
          line&lt;&lt;(c[h]).to_s
        <span class="hljs-keyword">end</span>
        csv &lt;&lt; line
      <span class="hljs-keyword">end</span>
      puts csv
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>


  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>pp
    <span class="hljs-keyword">self</span>.keys.keys.sort.each <span class="hljs-keyword">do</span> |k|
      puts <span class="hljs-string">"<span class="hljs-subst">#{k}</span>: <span class="hljs-subst">#{<span class="hljs-keyword">self</span>[k]}</span>"</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">nil</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>pp_to_s
    text=[]
    <span class="hljs-keyword">self</span>.keys.keys.sort.each <span class="hljs-keyword">do</span> |k|
      text&lt;&lt; <span class="hljs-string">" <span class="hljs-subst">#{k}</span>: <span class="hljs-subst">#{<span class="hljs-keyword">self</span>[k]}</span>;"</span>
    <span class="hljs-keyword">end</span>
    text.join <span class="hljs-string">""</span> 
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span>


<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ClassDataUtilities</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>export file_path
    <span class="hljs-constant">CSV</span>.open(file_path, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">do</span> |csv|
      headers=<span class="hljs-keyword">self</span>.keys.keys.sort
      puts headers
      csv &lt;&lt; headers
      <span class="hljs-keyword">self</span>.all.each <span class="hljs-keyword">do</span> |c|
        line=[]
        headers.each <span class="hljs-keyword">do</span> |h|
          line&lt;&lt;(c[h]).to_s
        <span class="hljs-keyword">end</span>
        csv &lt;&lt; line
      <span class="hljs-keyword">end</span>
      puts csv
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h2 id="utility-function-to-create-mongomapper-keys">Utility function to create mongomapper keys</h2>
<p>takes a file_path of teh csv file</p>
<p>prints keys in mongomapper format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">def</span> </span>csv_headers_to_keys file_path
  <span class="hljs-constant">CSV</span>.table(file_path).headers.sort!.each <span class="hljs-keyword">do</span> |x|
      puts <span class="hljs-string">"key :<span class="hljs-subst">#{x}</span>, String"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2 id="utility-for-exporting-a-mongomapper-search">Utility for exporting a mongomapper search</h2>
<p>takes a file name where all will be saved to in a csv format</p>
<p>saves csv file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Array</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>mongo_to_csv file_path
    <span class="hljs-constant">CSV</span>.open(file_path, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">do</span> |csv|
      headers=<span class="hljs-keyword">self</span>[<span class="hljs-number">0</span>].<span class="hljs-keyword">class</span>.keys.keys.sort
      puts headers
      csv &lt;&lt; headers
      <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |c|
        line=[]
        headers.each <span class="hljs-keyword">do</span> |h|
          line&lt;&lt;(c[h]).to_s
        <span class="hljs-keyword">end</span>
        csv &lt;&lt; line
      <span class="hljs-keyword">end</span>
      puts csv
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>mongo_to_table 
    file_path=<span class="hljs-constant">Tempfile</span>.new <span class="hljs-string">"test"</span>
    <span class="hljs-keyword">self</span>.mongo_to_csv file_path
    r=<span class="hljs-constant">CSV</span>.table file_path
    `rm <span class="hljs-comment">#{file_path}`</span>
    r
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span>


<span class="hljs-function"><span class="hljs-keyword">def</span> </span>val_to_csv val_name, file_name
  <span class="hljs-constant">Case</span>.find_all_by_validation_name(val_name).mongo_to_csv(file_name)
  puts <span class="hljs-string">"saved <span class="hljs-subst">#{<span class="hljs-constant">Case</span>.find_all_by_validation_name(val_name)}</span> in <span class="hljs-subst">#{<span class="hljs-constant">File</span>.absolute_path file_name}</span>"</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="a-modified-csv-table-class">A modified CSV table class</h2>
<p>pp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CSV::Table</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>pp
    puts <span class="hljs-keyword">self</span>.headers.to_csv
    <span class="hljs-keyword">self</span>.each <span class="hljs-keyword">do</span> |r|
      puts r.to_csv
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
